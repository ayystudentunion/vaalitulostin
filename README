== Yleisen ympäristön pystyttäminen

Projektissa on käytössä redis.

$ brew install redis
$ redis-server

Kehitysympäristön reset, tietokannan alustus ja seedidatan syöttö:
$ rake runts

Pelkän tietokannan alustaminen

$ rake db:create
$ rake db:schema:load
$ rake -T seed

Taustaprosessointia varten Delayed Job, worker kehitysympäristössä:

$ rake jobs:work

Herokuun projekti tarvitsee myös workerin.


== Tuotantoympäristön pystyttäminen

Tuotantoympäristö vaatii seuraavat ympäristömuuttujat:
- S3_ACCESS_KEY_ID
- S3_ACCESS_KEY_SECRET
- S3_BUCKET_NAME

% heroku config:add S3_ACCESS_KEY_ID=... S3_ACCESS_KEY_SECRET=... S3_BASE_URL=s3.amazonaws.com --app hyy-vaalit

Tuotanto-seed vaatii äänestysalueiden salasanojen syötön ennen `rake production_seed` komennon ajamista.
Ympäristö, jossa peruskonffit muttei vanhaa vaalidataa:

$ rake seed:production


== Kehitysympäristön pystyttäminen

Vuoden 2009 vaalien data:

$ rake seed:development

== Staging-ympäristön runtsaus

$ heroku pg:reset DATABASE --app APP_NAME
$ git push [-f] staging [staging:master]  # paikallinen staging-branch herokun master-branchiin.
$ heroku run rake db:schema:load --app APP_NAME
$ heroku run rake seed:[production|development] --app APP_NAME
$ heroku restart --app APP_NAME

== AWS
$ heroku config:set KEY=VALUE --app APP_NAME, seuraaville:
  * S3_BUCKET_NAME       (hyy-vaalitulos-staging)
  * S3_BASE_URL          (s3.amazonaws.com)
  * S3_ACCESS_KEY_ID     (IAM User)
  * S3_ACCESS_KEY_SECRET (IAM User)

NOTE: The AWS::S3 does not work properly with any other region than US.
Should try e.g. https://github.com/qoobaa/s3 for better S3 integration

== Heroku
  * Redis to go
    - Lisää Add-on
  * AWS-ympäristömuuttujat
    - Ks. yllä
  * Sendgrid (tuotantoon tarvii maksullisen)
    - ENV["SENDGRID_DOMAIN"]=hyy.fi


== Esimerkkikäyttäjätunnukset (testi-seed)

=== Salasanat
Kehitysympäristön salasanat: pass123
Tuotantoseedin esimerkkisalasanat: salainensana


=== ATK-vastaava
http://localhost:3000/admin
admin@example.com / pass123
Ks. kohta "Salasanat".


=== Äänestysalueet
Käyttäjätunnus tuotannossa: äänestysalueen tunnus, esimerkiksi:
  EI, EII, .., EIV
  I, II, III, .., XV

Käyttäjätunnus kehitysdatassa:
  E1, E2, .., E5
  1, 2, 3, ..., 20

Ks. kohta "Salasanat".


=== Tarkastuslaskenta
Käyttäjätunnus: tlkpj

Ks. kohta "Salasanat".


=== Asiamiesten korjaukset
Käyttäjätunnukset (kehitysympäristössä):
  asiamies1@example.com (123456-123K)
  asiamies2@example.com (123456-9876)

Ks. kohta "Salasanat".


